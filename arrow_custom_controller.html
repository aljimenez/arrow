<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Arrow : FE Test framework designed to promote TDD" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Custom Controller</title>
</head>
<body>


<script type="text/javascript" src="javascripts/header.js"> </script>
<script type="text/javascript" src="javascripts/menu.js"> </script>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
<section id="main_content" class="inner">

<h3><a name="The Custom Controller" class="anchor" href="#the-custom-controller"><span class="octicon octicon-link"></span></a>The Custom Controller</h3>
<p>
    User can write custom controller if the requirement is not getting fulfilled by the locator controller. It does support all the latest webdriver methods.
</p><p>
    For example, given below is the finance-controller.js which does similar to what we just explained in the locator controller sample.
</p>
<p>
    Based on the scenario above, our test descriptor file would look like this:
</p>
<pre>

 var util = require("util");
 var log4js = require("yahoo-arrow").log4js;
 var Controller = require("yahoo-arrow").controller;

 function FinanceCustomController(testConfig,args,driver) {
     Controller.call(this, testConfig,args,driver);

     this.logger = log4js.getLogger("FinanceCustomController");
 }

 util.inherits(FinanceCustomController, Controller);

 FinanceCustomController.prototype.execute = function(callback) {
     var self = this;

     if(this.driver.webdriver){

         //Get the various parameters needed from the Test Descriptor file
         var txtLocator =  this.testParams.txtLocator;
         var typeText =  this.testParams.typeText;
         var btnLocator =  this.testParams.btnLocator;
         var page = this.testParams.page;

         //Get a handle of the WebDriver Object
         var webdriver = this.driver.webdriver;

         //Open the page you want to test
         webdriver.get(page);
         webdriver.waitForElementPresent(webdriver.By.css(txtLocator));
         //Navigate the page as necessary
         webdriver.findElement(webdriver.By.css(txtLocator)).sendKeys(typeText);
         webdriver.findElement(webdriver.By.css(btnLocator)).click();
         webdriver.waitForElementPresent(webdriver.By.css(".title")).then(function() {
             self.driver.executeTest(self.testConfig, self.testParams, function(error, report) {
                callback(error);
             });

         });
     }else{
         this.logger.fatal("Custom Controllers are currently only supported on Selenium Browsers");
         callback("Custom Controllers are currently only supported on Selenium Browsers");
     }
 }

 module.exports = FinanceCustomController;
</pre>

The descriptor for the custom controller will be little different since we need the params to be passed from it and it looks like,

<pre>

 [
     {
         "settings":[ "master" ],

         "name":"controllers",

         "config":{
            "baseUrl":"http://finance.yahoo.com"
         },

         "dataprovider":{

             "Test YHOO Ticker using Finance Controller":{
                 "group":"func",
                 "controller":"finance-controller.js",
                 "params":{
                     "page":"$$config.baseUrl$$",
                     "txtLocator":".yucs-search-input",
                     "typeText":"yhoo",
                     "btnLocator":"#yucs-sprop_button",
                     "test":"test-quote.js",
                     "quote":"Yahoo! Inc. (YHOO)"
                 }
             }
         }
     },
     {
        "settings":[ "environment:development" ]
     }
 ]
</pre>
Custom controller best practice
<ol>
    <li>Make sure to include "var log4js = require("yahoo-arrow").log4js;" and "var Controller = require("yahoo-arrow").controller" to access yahoo-arrow.</li>
    <li>Make sure to include "waitForElementPresent(webdriver.By.css(".title"))" before calling the callback() to return to the test or else sometime, "ARROW is not defined" error will appear since the test try to execute before even loading the page completely.</li>
    <li>Make sure to include "self.testParams.page=null;" if you are on the page you want to be before calling your test</li>
</ol>

<h4><a name="Sharing test parameters among custom controllers and tests in a scenario node" class="anchor" href="#share-test-param"><span class="octicon octicon-link"></span></a>Sharing test parameters among custom controllers and tests in a scenario node</h4>
<p>
    In a complex test scenario, we may need multiple controllers or tests in a scenario node. Arrow provides a way to share variables among the controllers or tests, via this.testParams.shared.
    Custom controller or test can set a Json object to this.testParams.shared, then it will pass to downstream controllers and tests.
</p>
<p>
    The sample of sharing testParams from a test to another test can be found <a href="https://github.com/yahoo/arrow/tree/master/tests/functional/data/arrow_test/share_test_params/test_params_share-simple.json">here </a>.
</p>
<p>
    The sample of sharing testParams for a custom controller to downstream custom controller and test can be found <a href="https://github.com/yahoo/arrow/tree/master/tests/functional/data/arrow_test/share_test_params/search-descriptor-test-params.json">here</a>.
</p>
<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p class="copyright">Arrow maintained by <a href="https://github.com/yahoo">Yahoo</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
    </footer>
</div>
</body>
</html>